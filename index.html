<script>
    // *** สำคัญ: วาง URL ที่ได้จาก Google Apps Script Deployment ตรงนี้ ***
    const API_URL = "https://script.google.com/macros/s/AKfycbyXygmps6SockUxRUaWgwdyEMLYO5crLN6XoQXeNlUVDspQU6r_wG5cXZ-PbSoGvcKm/exec"; 

    let rawData = null;
    let pieChart, barChart;

    window.onload = () => {
        fetchData();
    };

    async function fetchData() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            init(data);
        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('loading').textContent = 'เกิดข้อผิดพลาดในการดึงข้อมูล: ' + error.message;
        }
    }

    function init(data) {
        rawData = data;
        document.getElementById('loading').style.display = 'none';

        // จัดการเรื่อง Filter (โค้ดเดียวกับเวอร์ชันที่แล้ว)
        renderFilters(data);
        updateDashboard();
    }

    // ... ฟังก์ชัน renderFilters(), updateDashboard(), updateCharts(), updateTable() ...
    // ก๊อปปี้จากเวอร์ชันก่อนหน้ามาใส่ได้เลยครับ
</script>
